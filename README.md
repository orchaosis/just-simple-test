# just-simple-test
this is optional



;====================================================================
; Main.asm file generated by New Project wizard
;
; Created:   Cum Mar 11 2016
; Processor: 8086
; Compiler:  MASM32
;
; Before starting simulation set Internal Memory Size 
; in the 8086 model properties to 0x10000
;====================================================================
STAK    SEGMENT PARA STACK 'STACK'
        DW 20 DUP(?)
STAK    ENDS

DATA    SEGMENT PARA 'DATA'
MYDAT   DB 5 DUP(0)
DATA    ENDS

CODE    SEGMENT PARA 'CODE'
        ASSUME CS:CODE, DS:DATA, SS:STAK

	
VERI_AL PROC FAR

	 CMP DI,5
	 JE PRINT
	
	
	IN AL, 7CH
	SHR AL,1; necessary
	INC AL
	MOV MYDAT[DI] ,AL;
	INC DI
	
	 CMP DI,5
	 JE PRINT

	IRET 
	
	PRINT:
	XOR SI,SI
	MOV AL ,MYDAT[SI]
	OUT 7CH , AL
	INC SI
	
LRESS:
	
	IRET 
	
VERI_AL ENDP


VERI_GONDER PROC FAR
	CMP SI ,0
	JE GEC
	

	MOV AL ,MYDAT[SI]
	OUT 7CH ,AL;
	INC SI
	
	CMP SI ,5
	JNE GEC
	
	
	FINISH:
	XOR SI,SI
	XOR DI,DI
	
	IN AL, 7CH
	SHR AL,1; necessary
	INC AL
	MOV MYDAT[DI] ,AL;
	INC DI
	
	
	GEC:
	IRET
	
VERI_GONDER ENDP



START PROC FAR


        MOV AX, DATA
	MOV DS, AX
	
	XOR SI, SI
	XOR DI, DI
	

	;8251 ayarlar

	MOV DX, 7EH ;8251 baslangic adresinden itibaren yazilacak
	MOV AL, 4DH ;Mod yazmacini ayarliyoruz
	;0100 1101 
	OUT DX, AL
	
	MOV AL, 40H ;Resetlemek icin
	OUT DX, AL
	
	MOV AL, 4DH ;Tekrar modu yukluyoruz
	OUT DX, AL
	
	MOV AL, 15H ;Kontrol yazmacini ayarliyoruz
	;0001 0101
	OUT DX, AL
	
	
	;Kesme vektor tablosuna ilgili alt programlarin yazilmasi
	
	;Veri al programi icin
	XOR AX, AX
	MOV ES, AX
	MOV AL, 78H
	MOV AH, 4
	MUL AH
	MOV BX, AX
	LEA AX, VERI_AL
        MOV WORD PTR ES:[BX], AX
        MOV AX, CS
        MOV WORD PTR ES:[BX+2], AX 
	
	;Veri gonder programi icin
	XOR AX, AX
	MOV ES, AX
	MOV AL, 79H
	MOV AH, 4
	MUL AH
	MOV BX, AX
	LEA AX, VERI_GONDER
        MOV WORD PTR ES:[BX], AX
        MOV AX, CS
        MOV WORD PTR ES:[BX+2], AX 
	
	
;8259 ayarlar

	MOV AL, 13H ;ICW1 WORD
	OUT 60H, AL ;8259 baslangic adresi
	MOV AL, 78H ;ICW2 WORD
	OUT 62H, AL ;8259 son adresi
	MOV AL, 03H ;ICW4 WORD
	OUT 62H, AL ;8259 son adresi
	
	
	
	XOR AX, AX
	MOV SI, 0
	XOR DI,DI
	XOR DX,DX
	XOR BX,BX
	STI

	
	

ENDLESS:


JMP ENDLESS
RET
START ENDP
	

CODE    ENDS
        END START
